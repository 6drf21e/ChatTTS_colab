# ChatTTS_colab

> ğŸš€ ä¸€é”®éƒ¨ç½²ï¼ˆå«ç¦»çº¿æ•´åˆåŒ…ï¼‰ï¼åŸºäº [ChatTTS](https://github.com/2noise/ChatTTS)  ï¼Œæ”¯æŒéŸ³è‰²æŠ½å¡ã€é•¿éŸ³é¢‘ç”Ÿæˆå’Œåˆ†è§’è‰²æœ—è¯»ã€‚ç®€å•æ˜“ç”¨ï¼Œæ— éœ€å¤æ‚å®‰è£…ã€‚ã€‚

| ç‰ˆæœ¬       | åœ°å€                                                                                                                                                                             | ä»‹ç»                                                  |
|----------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------|
| åœ¨çº¿Colabç‰ˆ | [![Open In Colab](https://colab.research.google.com/assets/colab-badge.svg)](https://colab.research.google.com/github/6drf21e/ChatTTS_colab/blob/main/chattts_webui_mix.ipynb) | å¯ä»¥åœ¨ Google Colab ä¸Šä¸€é”®è¿è¡Œï¼Œéœ€è¦ Googleè´¦å·ï¼ŒColib è‡ªå¸¦15GBçš„GPU |
| ç¦»çº¿æ•´åˆç‰ˆ    | [ç™¾åº¦ç½‘ç›˜](https://pan.baidu.com/s/1-hGiPLs6ORM8sZv0xTdxFA?pwd=h3c5) æå–ç : h3c5                                                                                                     | ä¸‹è½½æœ¬åœ°è¿è¡Œï¼Œæ”¯æŒ GPU/CPUï¼Œé€‚ç”¨ Windows 10 åŠä»¥ä¸Š                 |
| ç¦»çº¿æ•´åˆç‰ˆ    | [å¤¸å…‹ç½‘ç›˜](https://pan.quark.cn/s/c963e147f204)                                                                                                                                    | ä¸‹è½½æœ¬åœ°è¿è¡Œï¼Œæ”¯æŒ GPU/CPUï¼Œé€‚ç”¨ Windows 10 åŠä»¥ä¸Š                 |

# æ¼”ç¤ºè§†é¢‘

[![æ¼”ç¤ºè§†é¢‘](https://img.youtube.com/vi/199fyU7NfUQ/0.jpg)](https://www.youtube.com/watch?v=199fyU7NfUQ)

æ¬¢è¿å…³æ³¨ [æ°ªå­¦å®¶é¢‘é“](https://www.youtube.com/@kexue) ï¼Œè·å–æ›´å¤šæœ‰è¶£çš„ç§‘æŠ€è§†é¢‘ã€‚

## ç‰¹ç‚¹

- **Colab ä¸€é”®è¿è¡Œ**ï¼šæ— éœ€å¤æ‚çš„ç¯å¢ƒé…ç½®ï¼Œåªéœ€ç‚¹å‡»ä¸Šæ–¹çš„ Colab æŒ‰é’®ï¼Œå³å¯åœ¨æµè§ˆå™¨ä¸­ç›´æ¥è¿è¡Œé¡¹ç›®ã€‚
- **éŸ³è‰²æŠ½å¡åŠŸèƒ½**ï¼šæ‰¹é‡ç”Ÿæˆå¤šä¸ªéŸ³è‰²ï¼Œå¹¶å¯ä¿å­˜è‡ªå·±å–œæ¬¢çš„éŸ³è‰²ã€‚
- **æ”¯æŒç”Ÿæˆé•¿éŸ³é¢‘**ï¼šé€‚åˆç”Ÿæˆè¾ƒé•¿çš„è¯­éŸ³å†…å®¹ã€‚
- **å­—ç¬¦å¤„ç†**ï¼šå¯¹æ•°å­—å’Œæœ—è¯»é”™è¯¯çš„æ ‡ç‚¹åšäº†åˆæ­¥å¤„ç†ã€‚
- **åˆ†è§’è‰²æœ—è¯»åŠŸèƒ½** ï¼šæ”¯æŒå¯¹ä¸åŒè§’è‰²çš„æ–‡æœ¬è¿›è¡Œåˆ†è§’è‰²æœ—è¯»ï¼Œå¹¶æ”¯æŒå¤§æ¨¡å‹ä¸€é”®ç”Ÿäº§è„šæœ¬ã€‚

## åŠŸèƒ½å±•ç¤º

### åˆ†è§’è‰²æœ—è¯»åŠŸèƒ½

![åˆ†è§’è‰²æœ—è¯»åŠŸèƒ½](assets/shot3.png)

### éŸ³è‰²æŠ½å¡åŠŸèƒ½

![éŸ³è‰²æŠ½å¡åŠŸèƒ½](assets/shot1.png)

### æ”¯æŒç”Ÿæˆé•¿éŸ³é¢‘

![ç”Ÿæˆé•¿éŸ³é¢‘](assets/shot2.png)

## å¿«é€Ÿå¼€å§‹

### åœ¨ Colab è¿è¡Œ

1. ç‚¹å‡»æœ€ä¸Šæ–¹çš„ "Open In Colab" æŒ‰é’®ï¼Œæ‰“å¼€ Colab ç¬”è®°æœ¬ã€‚
2. ç‚¹å‡»èœå•æ çš„â€“ä»£ç æ‰§è¡Œç¨‹åºâ€“å…¨éƒ¨è¿è¡Œå³å¯
3. æ‰§è¡Œååœ¨ä¸‹æ–¹çš„æ—¥å¿—ä¸­æ‰¾åˆ°ç±»ä¼¼
   Running on public URL: https://**********.gradio.live
4. https://**********.gradio.live å°±æ˜¯å¯ä»¥è®¿é—®çš„å…¬ç½‘åœ°å€

### åœ¨ macOS ä¸Šè¿è¡Œ

1. å®‰è£… [Conda](https://docs.conda.io/projects/conda/en/latest/user-guide/install/macos.html)ï¼ˆå¦‚æœå°šæœªå®‰è£…ï¼‰ã€‚
2. æ‰“å¼€ç»ˆç«¯ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ conda ç¯å¢ƒï¼š
   ```bash
   conda create -n "ChatTTS_colab" python=3.11
   ```
3. æ¿€æ´»åˆšåˆ›å»ºçš„ç¯å¢ƒï¼š
   ```bash
   conda activate ChatTTS_colab
   ```
3. å…‹éš†æœ¬é¡¹ç›®ä»“åº“åˆ°æœ¬åœ°ï¼š
   ```bash
   git clone git@github.com:6drf21e/ChatTTS_colab.git
   ```
4. æ‰‹åŠ¨å®‰è£… ChatTTS ä¾èµ–åˆ°é¡¹ç›®ç›®å½•ï¼š
   ```bash
   cd ChatTTS_colab
   git clone https://github.com/2noise/ChatTTS
   cd ChatTTS
   git checkout -q f4c8329
   cd ..
   mv ChatTTS temp
   mv temp/ChatTTS ./ChatTTS
   rm -rf temp
   ```
5. åœ¨é¡¹ç›®ç›®å½•å®‰è£… ChatTTS_colab æ‰€éœ€çš„ä¾èµ–ï¼š
   ```bash
   pip install -r requirements-macos.txt
   ```
6. è¿è¡Œé¡¹ç›®ï¼Œç­‰å¾…è‡ªåŠ¨ä¸‹è½½æ¨¡å‹ï¼š
   ```bash
   python webui_mix.py
   # Loading ChatTTS model...
   ```
   ä¸€åˆ‡æ­£å¸¸çš„è¯ä¼šè‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨ã€‚

## å¸¸è§é—®é¢˜ï¼š

1. ç¬¬ä¸€æ¬¡è¿è¡Œé¡¹ç›®ï¼ŒChatTTS ä¼šè‡ªåŠ¨ä» huggingface ä¸‹è½½æ¨¡å‹ï¼Œå¦‚æœå› ä¸ºç½‘ç»œé—®é¢˜ä¸‹è½½å¤±è´¥ï¼Œé‚£ä¹ˆ ChatTTS æ˜¯æ— æ³•è‡ªè¡Œé‡æ–°ä¸‹è½½çš„ï¼Œéœ€è¦æ¸…é™¤ç¼“å­˜åé‡æ–°è§¦å‘ä¸‹è½½ã€‚
   é”™è¯¯ä¿¡æ¯ç¤ºä¾‹ï¼š
   ```log
   FileNotFoundError: [Errno 2] No such file or directory: '~/.cache/huggingface/hub/models--2Noise--ChatTTS/snapshots/d7474137acb4f988874e5d57ad88d81bcb7e10b6/asset/Vocos.pt'
   ```
   æ¸…é™¤ç¼“å­˜çš„æ–¹æ³•ï¼š
   ```bash
   rm -rf ~/.cache/huggingface/hub/models--2Noise--ChatTTS
   ```
   æ¸…é™¤ç¼“å­˜åï¼Œå†æ¬¡æ‰§è¡Œ `python webui_mix.py`ï¼Œå°±ä¼šé‡æ–°ä¸‹è½½æ¨¡å‹ã€‚

   å¦‚æœå¤šæ¬¡ä¸‹è½½éƒ½æ— æ³•æˆåŠŸï¼Œå¯ä»¥æ‰‹åŠ¨å°†**ç¦»çº¿åŒ…**é‡Œçš„ models æ‹·è´åˆ°é¡¹ç›®ç›®å½•ï¼Œä»æœ¬åœ°åŠ è½½æ¨¡å‹
   ```bash
      python webui_mix.py --source local --local_path models
   ```
2. å¦‚æœä¸‹è½½æ¨¡å‹é€Ÿåº¦æ…¢ï¼Œå»ºè®®ä½¿ç”¨èµ›åšæ´»è©è¨ [@padeoe](https://github.com/padeoe) çš„é•œåƒåŠ é€Ÿ https://hf-mirror.com/ 
   ```bash
    export HF_ENDPOINT=https://hf-mirror.com
   ```
## apiæ¥å£ä½¿ç”¨

å¯åŠ¨æ¥å£æœåŠ¡

```
python3 api.py
```

getè¯·æ±‚ï¼š

```
http://localhost:9880/?text=æˆ‘é—®å¥¹æœˆé¥¼çˆ±åƒå’¸çš„è¿˜æ˜¯ç”œçš„ï¼Œé‚£å¤©è€è‰²é¬¼è¯´,ä½ èº«ä¸Šçš„æœˆé¥¼ï¼Œè‡ªç„¶æ˜¯ç”œè¿‡äº†èœœç³–ã€‚&seed=2
```

postè¯·æ±‚ï¼š

```
import requests
import json
data = json.dumps({"text":"æˆ‘é—®å¥¹æœˆé¥¼çˆ±åƒå’¸çš„è¿˜æ˜¯ç”œçš„ï¼Œé‚£å¤©è€è‰²é¬¼è¯´,ä½ èº«ä¸Šçš„æœˆé¥¼ï¼Œè‡ªç„¶æ˜¯ç”œè¿‡äº†èœœç³–","seed":2})
url = "http://localhost:9880"
headers = {"Content-Type":"application/json"}
r = requests.post(url,data=data,headers=headers)
audio_data = r.content

with open(f"æµ‹è¯•éŸ³é¢‘.wav","wb") as f:
   f.write(audio_data)
```

æ¥å£æ”¯æŒéŸ³è‰²å‘é‡è§’è‰²å‚æ•°roleidï¼Œå‚è§webui,æ”¯æŒæµå¼å‚æ•°:streaming=1

## æœ¬åœ°ollamaå¤§æ¨¡å‹ç”Ÿæˆè§’è‰²å‰§æœ¬

ä¸‹è½½æƒé‡ï¼šhttps://huggingface.co/shenzhi-wang/Mistral-7B-v0.3-Chinese-Chat-4bit

æ–°å»ºtemplateæ–‡ä»¶ï¼šModelflie_mistral7b0.3.txt

```
FROM .\Mistral-7B-v0.3-Chinese-Chat-q4_0.gguf

#è®¾ç½®æ¨¡å‹æ¸©åº¦ï¼ˆå€¼è¶Šå°å›ç­”è¶Šä¸¥è°¨ï¼Œå€¼è¶Šå¤§å›ç­”è¶Šå‘æ•£ï¼‰
PARAMETER temperature 0.8

#è®¾ç½®ä¸Šä¸‹æ–‡tokenå°ºå¯¸
PARAMETER num_ctx 4096

TEMPLATE """[INST] {{ if .System }}{{ .System }} {{ end }}{{ .Prompt }} [/INST]
"""

SYSTEM """ä½ æ˜¯ä¸€åä½œå®¶ï¼Œæ–‡è¾ä¼˜ç¾ï¼Œæ“…é•¿è½¬å†™è¯å‰§å’Œå½±è§†å‰§çš„å‰§æœ¬"""
```

å¯¼å…¥æ¨¡å‹:

```
ollama create nsfw -f Modelflie_mistral7b0.3.txt
```

å¯åŠ¨æœåŠ¡ï¼š

```
ollama serve
```

## è´¡çŒ®

æ¬¢è¿å¯¹æœ¬é¡¹ç›®æå‡ºå»ºè®®æˆ–è´¡çŒ®ä»£ç ã€‚è¯·é€šè¿‡ GitHub Issues æå‡ºé—®é¢˜ï¼Œæˆ–æäº¤ Pull Requestã€‚

## è®¸å¯è¯

æœ¬é¡¹ç›®ä½¿ç”¨ MIT è®¸å¯è¯ã€‚

